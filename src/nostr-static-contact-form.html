<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact Form</title>
    <style>
      /* Prevent scrollbars inside the iframe */
      html, body {
        height: 100%;
        overflow: hidden !important;      /* no vertical or horizontal scroll */
        background: #fff !important;
      }
      body {
        margin: 0 !important;
        padding: 0 !important;
        font-family: system-ui, -apple-system, sans-serif;
        color: #333;
        overscroll-behavior: none;        /* no bounce on mobile */
        -ms-overflow-style: none;         /* IE/Edge */
        scrollbar-width: none;            /* Firefox */
      }
      /* Hide WebKit scrollbars just in case */
      body::-webkit-scrollbar { display: none; }

      h2 {
        margin: 0 0 10px 0;
        font-size: 1.5em;
        text-align: center;
      }
      label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
      }
      textarea { resize: vertical; min-height: 100px; }
      #result {
        text-align: center;
        margin-top: 20px;
        font-size: 1.2em;
        font-weight: bold;
      }
    </style>
    <!-- Load nostr-tools v2.10.4 -->
    <script src="https://cdn.jsdelivr.net/npm/nostr-tools@2.10.4/lib/nostr.bundle.min.js"></script>
  </head>
  <body style="background:#fff !important;">
    <!-- Full-screen container (no overflow) -->
    <div
      class="form-container"
      style="
        width:100% !important;
        height:100dvh !important;               /* fill viewport without causing scroll */
        background:#fff !important;
        border-radius:0 !important;
        box-shadow:none !important;
        margin:0 !important;
        padding:24px !important;
        box-sizing:border-box !important;       /* include padding in height */
        display:flex !important;
        align-items:center !important;
        justify-content:center !important;
        overflow:hidden !important;             /* belt & suspenders */
      "
    >
      <div class="form-inner" style="width:100% !important; max-width:640px !important;">
        <h2>Contact Form</h2>
        <form id="contact-form">
          <label for="name">Name</label>
          <input
            type="text"
            id="name"
            placeholder="Your name"
            required
            style="
              width:100% !important; padding:10px !important; margin-top:5px !important;
              border:1px solid #000 !important; border-radius:0 !important; box-sizing:border-box !important;
              background:#fff !important; color:inherit !important; box-shadow:none !important;
              -webkit-appearance:none !important; appearance:none !important;
            "
          />
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            placeholder="Your email"
            required
            style="
              width:100% !important; padding:10px !important; margin-top:5px !important;
              border:1px solid #000 !important; border-radius:0 !important; box-sizing:border-box !important;
              background:#fff !important; color:inherit !important; box-shadow:none !important;
              -webkit-appearance:none !important; appearance:none !important;
            "
          />
          <label for="message">Message</label>
          <textarea
            id="message"
            placeholder="Your message"
            required
            style="
              width:100% !important; padding:10px !important; margin-top:5px !important;
              border:1px solid #000 !important; border-radius:0 !important; box-sizing:border-box !important;
              background:#fff !important; color:inherit !important; box-shadow:none !important;
              -webkit-appearance:none !important; appearance:none !important;
              min-height:100px !important; resize:vertical !important;
            "
          ></textarea>
          <button
            type="submit"
            style="
              display:block !important; width:100% !important; padding:10px !important; margin-top:20px !important;
              background:#000 !important; color:#fff !important; border:1px solid #000 !important;
              border-radius:0 !important; font-size:1em !important; cursor:pointer !important;
              box-shadow:none !important; text-shadow:none !important;
            "
          >
            Send Message
          </button>
        </form>
        <div id="result"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("contact-form");
        const resultDiv = document.getElementById("result");

        // Set the admin recipient NPUB here.
        const recipientNpub = "npubYOURADMINNPUBHERE"; // Replace with your NPUB

        // Relay URLs for publishing events.
        const RELAYS = [
          "wss://relay.snort.social",
          "wss://relay.damus.io",
          "wss://relay.primal.net"
        ];
        const pool = new window.NostrTools.SimplePool();

        form.addEventListener("submit", async (ev) => {
          ev.preventDefault();
          resultDiv.textContent = "";
          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();
          const message = document.getElementById("message").value.trim();

          const content = `
# Contact Form Submission

**Name:** ${name}
**Email:** ${email}
**Message:**
${message}
          `.trim();

          try {
            const decoded = window.NostrTools.nip19.decode(recipientNpub);
            if (decoded.type !== "npub") throw new Error("Invalid recipient NPUB");
            const targetPubHex = decoded.data;

            const ephemeralPriv = window.NostrTools.generateSecretKey();
            const ciphertext = await window.NostrTools.nip04.encrypt(
              ephemeralPriv, targetPubHex, content
            );

            const now = Math.floor(Date.now() / 1000);
            const eventTemplate = {
              kind: 4,
              created_at: now,
              tags: [["p", targetPubHex]],
              content: ciphertext,
            };

            const event = window.NostrTools.finalizeEvent(eventTemplate, ephemeralPriv);
            await Promise.any(pool.publish(RELAYS, event));

            resultDiv.textContent = "Success: Your message has been sent.";
            form.reset();
          } catch (err) {
            console.error(err);
            resultDiv.textContent = "Failed: Your message could not be sent.";
          }
        });
      });
    </script>
  </body>
</html>
